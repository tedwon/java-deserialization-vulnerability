package org.jbugkorea.security.vulnerability.serialization;

import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.io.ObjectStreamClass;

/**
 * https://www.tutorialspoint.com/java/io/objectinputstream_resolveclass.htm
 */
public class ObjectInputStreamDemo extends ObjectInputStream {

    public ObjectInputStreamDemo(InputStream in) throws IOException {
        super(in);
    }

    public static void main(String[] args) {
        String s = "Hello World";

        try {

            // create a new file with an ObjectOutputStream
            FileOutputStream out = new FileOutputStream("/tmp/test.txt");
            ObjectOutputStream oout = new ObjectOutputStream(out);

            // write something in the file
            oout.writeUTF(s);
            oout.flush();

            // create an ObjectInputStream for the file we created before
            ObjectInputStreamDemo ois = new ObjectInputStreamDemo(new FileInputStream("/tmp/test.txt"));

            // read and print an object and cast it as string
            System.out.println("" + (String) ois.readUTF());

            // get the class for string and print the name
            ObjectStreamClass streamClass = ObjectStreamClass.lookup(Integer.class);
            System.out.println("" + ois.resolveClass(streamClass).getName());

        } catch (Exception ex) {
            ex.printStackTrace();
        }

    }
}